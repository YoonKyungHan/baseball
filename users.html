<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìœ ì € ì´ë ¥</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="app-page">
  <div class="history-page">
    <div class="history-card">
      <div class="history-header">
        <h1>ğŸ‘¥ ìœ ì € ì´ë ¥</h1>
        <div class="history-actions">
          <a href="lobby.html" class="btn btn-secondary">â† ë¡œë¹„ë¡œ</a>
        </div>
      </div>

      <div class="history-controls">
        <div class="control-group">
          <label for="limitSelect">í‘œì‹œ ê°œìˆ˜</label>
          <select id="limitSelect">
            <option value="50">ìµœê·¼ 50ê°œ</option>
            <option value="100">ìµœê·¼ 100ê°œ</option>
            <option value="200">ìµœê·¼ 200ê°œ</option>
          </select>
        </div>
        <div class="control-buttons">
          <button id="refreshBtn" class="btn btn-primary">ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>

      <div id="userTimeline" class="history-timeline"></div>
    </div>
  </div>

  <script>
    async function fetchUsers(limit=50){
      const res = await fetch(`/api/users?limit=${encodeURIComponent(limit)}`);
      const data = await res.json();
      return data.items || [];
    }
    function fmt(iso){try{const d=new Date(iso);return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;}catch{return iso;}}
    function render(items){
      const el = document.getElementById('userTimeline');
      el.innerHTML = items.map(it=>{
        const when = fmt(it.at);
        const who = it.playerName || it.playerId || 'ì•Œ ìˆ˜ ì—†ìŒ';
        const ev = it.event === 'join' ? 'ì ‘ì†' : (it.event === 'leave' ? 'í‡´ì¥' : it.event);
        return `<div class="timeline-item"><div class="time">${when}</div><div class="content"><div class="title">${who}</div><div class="meta">${ev}</div></div></div>`;
      }).join('');
    }
    async function load(){
      const limit = parseInt(document.getElementById('limitSelect').value,10)||50;
      const items = await fetchUsers(limit);
      render(items);
    }
    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('refreshBtn').addEventListener('click', load);
      document.getElementById('limitSelect').addEventListener('change', load);
      load();
    });
  </script>
</body>
</html>

